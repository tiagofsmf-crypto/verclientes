<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gaia Phone - Gestão de Clientes</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
h1 { text-align: center; color: #333; }
.logo { display: block; margin: 0 auto 20px auto; width: 150px; }
.form-container, .list-container, .print-container {
background: white; padding: 20px; margin-bottom: 20px;
border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
input, select, button {
display: block; margin: 10px 0; padding: 10px;
width: 100%; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;
}
button { background-color: #007BFF; color: white; border: none; cursor: pointer; }
button:hover { background-color: #0056b3; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
table, th, td { border: 1px solid #ddd; }
th, td { padding: 10px; text-align: left; }
@media print {
body * { visibility: hidden; }
.print-container, .print-container * { visibility: visible; }
.print-container { position: absolute; left: 0; top: 0; width: 100%; }
}
</style>
</head>
<body>

<h1>Gaia Phone - Gestão de Clientes</h1>
<img src="logo.png" alt="Logo Gaia Phone" class="logo">

<div class="form-container">
<h2>Adicionar Cliente</h2>
<input type="text" id="nome" placeholder="Nome">
<input type="text" id="telefone" placeholder="Telefone">
<input type="text" id="morada" placeholder="Morada">
<input type="text" id="marca" placeholder="Marca do Equipamento">
<input type="text" id="modelo" placeholder="Modelo do Equipamento">
<input type="text" id="avaria" placeholder="Avaria">
<input type="email" id="email" placeholder="Email">
<button onclick="adicionarCliente()">Adicionar Cliente</button>
</div>

<div class="list-container">
<h2>Clientes</h2>
<input type="text" id="buscarTelefone" placeholder="Procurar por telefone" oninput="filtrarClientes()">
<select id="clienteSelect" onchange="mostrarCliente()">
<option value="">-- Selecionar Cliente --</option>
</select>
</div>

<div class="print-container" id="printContainer" style="display:none;">
<h2>Ficha do Cliente</h2>
<img src="logo.png" alt="Logo Gaia Phone" class="logo">
<p><strong>Nome:</strong> <span id="pNome"></span></p>
<p><strong>Telefone:</strong> <span id="pTelefone"></span></p>
<p><strong>Morada:</strong> <span id="pMorada"></span></p>
<p><strong>Email:</strong> <span id="pEmail"></span></p>
<p><strong>Marca:</strong> <span id="pMarca"></span></p>
<p><strong>Modelo:</strong> <span id="pModelo"></span></p>
<p><strong>Avaria:</strong> <span id="pAvaria"></span></p>
<p><strong>Data de Registo:</strong> <span id="pData"></span></p>
<button onclick="window.print()">Imprimir</button>
</div>

<script>
const BIN_ID = "68f9f8dbae596e708f25f839";
const MASTER_KEY = "$2a$10$dG2ThExIwcpAMH8TWK7.nutw7YbLh999/nA8ZIHUebC2Bgxg.kxbC";
let clientes = [];

// Função para carregar clientes do JSONBin
async function carregarClientes() {
try {
const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
headers: { "X-Master-Key": MASTER_KEY }
});
const data = await res.json();
clientes = data.record.clientes || [];
atualizarSelect();
} catch (e) {
console.error("Erro ao carregar clientes:", e);
}
}

// Atualiza o select com clientes
function atualizarSelect(filtrar = "") {
const select = document.getElementById('clienteSelect');
select.innerHTML = '<option value="">-- Selecionar Cliente --</option>';
clientes.forEach((c, index) => {
if (!filtrar || c.telefone.includes(filtrar)) {
const option = document.createElement('option');
option.value = index;
option.text = `${c.nome} - ${c.telefone}`;
select.add(option);
}
});
}

// Adicionar cliente
async function adicionarCliente() {
const nome = document.getElementById('nome').value.trim();
const telefone = document.getElementById('telefone').value.trim();
const morada = document.getElementById('morada').value.trim();
const marca = document.getElementById('marca').value.trim();
const modelo = document.getElementById('modelo').value.trim();
const avaria = document.getElementById('avaria').value.trim();
const email = document.getElementById('email').value.trim();
const data = new Date().toLocaleDateString();

if (!nome || !telefone) { alert("Preencha nome e telefone!"); return; }

clientes.push({ nome, telefone, morada, marca, modelo, avaria, email, data });
await salvarClientes();
atualizarSelect();
document.querySelectorAll('.form-container input').forEach(i => i.value = '');
}

// Salvar clientes no JSONBin
async function salvarClientes() {
try {
await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
method: "PUT",
headers: {
"Content-Type": "application/json",
"X-Master-Key": MASTER_KEY,
"X-Bin-Versioning": "false"
},
body: JSON.stringify({ clientes })
});
} catch (e) {
console.error("Erro ao salvar clientes:", e);
}
}

// Mostrar cliente selecionado
function mostrarCliente() {
const index = document.getElementById('clienteSelect').value;
if (index === "") return;
const c = clientes[index];
document.getElementById('pNome').innerText = c.nome;
document.getElementById('pTelefone').innerText = c.telefone;
document.getElementById('pMorada').innerText = c.morada;
document.getElementById('pEmail').innerText = c.email;
document.getElementById('pMarca').innerText = c.marca;
document.getElementById('pModelo').innerText = c.modelo;
document.getElementById('pAvaria').innerText = c.avaria;
document.getElementById('pData').innerText = c.data;
document.getElementById('printContainer').style.display = 'block';
}

// Filtrar clientes por telefone
function filtrarClientes() {
const valor = document.getElementById('buscarTelefone').value.trim();
atualizarSelect(valor);
}

// Carrega clientes ao abrir a página
carregarClientes();
</script>

</body>
</html>
